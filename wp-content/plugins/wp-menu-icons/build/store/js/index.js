!function(){"use strict";var e={n:function(r){var t=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(t,{a:t}),t},d:function(r,t){for(var n in t)e.o(t,n)&&!e.o(r,n)&&Object.defineProperty(r,n,{enumerable:!0,get:t[n]})},o:function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},r={};e.r(r),e.d(r,{INITIAL_STATE:function(){return c},STORE_NAME:function(){return o},WPMI_STORE_NAME:function(){return G},actions:function(){return n},apiFetch:function(){return m},fetchRestApiDeleteLibrary:function(){return R},fetchRestApiLibraries:function(){return S},fetchRestApiLibrariesUpload:function(){return _},fetchRestApiMenu:function(){return w},fetchRestApiSettings:function(){return v},getIcons:function(){return E},reducer:function(){return i},resolvers:function(){return s},selectors:function(){return t},useCurrentLibrary:function(){return I},useCurrentLibraryIconMap:function(){return T},useLibraries:function(){return C},useSettingsEntities:function(){return A}});var t={};e.r(t),e.d(t,{getCurrentLibrary:function(){return d},getCurrentLibraryName:function(){return l},getLibraries:function(){return u},getSettings:function(){return b}});var n={};e.r(n),e.d(n,{deleteLibrary:function(){return O},saveSettings:function(){return $},setCurrentLibraryName:function(){return k},setLibraries:function(){return M},setSettings:function(){return P},uploadLibrary:function(){return j}});var s={};e.r(s),e.d(s,{getCurrentLibraryName:function(){return F},getLibraries:function(){return B},getSettings:function(){return D}});var i={};e.r(i),e.d(i,{default:function(){return x}});var a=window.wp.data;const o="wpmi/store",c={currentLibraryName:"dashicons",settings:{active_libraries:[]},libraries:[]},u=e=>e.libraries,l=e=>e.currentLibraryName,d=e=>{const{libraries:r,currentLibraryName:t}=e;return r.find((e=>e.name===t))},b=e=>e.settings;var y=window.wp.i18n,f=window.wp.notices,p=window.wp.apiFetch,h=e.n(p),g=window.wp.element;const{WPMI_REST_ROUTES:L}=wpmi_store;async function m(e){return await h()(e).then((e=>e)).catch((e=>{throw new Error(e)}))}const S=({method:e,data:r,headers:t}={})=>m({path:L.libraries,method:e,data:r,headers:t}),_=({method:e,body:r,headers:t}={})=>m({path:L.libraries_upload,method:e,body:r,headers:t}),R=e=>m({path:L.libraries+`?library_name=${e}`,method:"DELETE"}),v=({method:e,data:r}={})=>m({path:L.settings,method:e,data:r}),w=e=>m({path:L.navmenu+"?id="+e}),N=(()=>{const e=document.createElement("link");return e.rel="stylesheet",e.href="",document.head.append(e),{setHref:r=>{r&&(e.href=r)}}})(),E=async e=>{if(!e.is_loaded)return[];if(e.iconmap)return e.iconmap.split(",");if(e.json_file_url){const r=await fetch(new Request(e.json_file_url,{cache:"no-store"}));if(!r.ok)return[];const t=await r.json(),{prefix:n}=e;return t.IcoMoonType?t.icons.map((e=>n+e.properties.name)):t.glyphs.map((e=>n+e.css))}return[]},T=()=>{const[e,r]=(0,g.useState)([]),[t,n]=(0,g.useState)(!1),s=(0,a.useSelect)((e=>{const{getCurrentLibrary:r}=e(o);return r()}),[]);return(0,g.useEffect)((()=>{s?(n(!0),E(s).then((e=>{r(e),n(!1)}))):r([])}),[s]),{iconMap:e,isLoadingIconMap:t,filterIcons:r=>e.filter((e=>e.includes(r)))}},C=()=>{const{libraries:e,isResolvingLibraries:r,hasResolvedLibraries:t}=(0,a.useSelect)((e=>{const{getLibraries:r,isResolving:t,hasFinishedResolution:n}=e(o);return{libraries:r(),isResolvingLibraries:t("getLibraries"),hasResolvedLibraries:n("getLibraries")}}),[]),{uploadLibrary:n,deleteLibrary:s}=(0,a.useDispatch)(o);return{libraries:e,isResolvingLibraries:r,hasResolvedLibraries:t,hasLibraries:!(!t||!e?.length),uploadLibrary:n,deleteLibrary:s}},I=()=>{const{currentLibrary:e,currentLibraryName:r,isResolvingCurrentLibrary:t,hasResolvedCurrentLibrary:n}=(0,a.useSelect)((e=>{const{getCurrentLibraryName:r,getLibraries:t,isResolvingCurrentLibrary:n,hasFinishedResolution:s}=e(o),i=document.getElementById("menu")?.value,a=t(),c=r(i),u=a.find((e=>e.name===c));if(u?.is_loaded){const{stylesheet_file_url:e=""}=u;N.setHref(e)}return{currentLibrary:u,currentLibraryName:c,isResolvingCurrentLibrary:n,hasResolvedCurrentLibraryName:s("getCurrentLibraryName")}}),[]),{setCurrentLibraryName:s}=(0,a.useDispatch)(o);return{currentLibrary:e,currentLibraryName:r,setCurrentLibraryName:s,isResolvingCurrentLibrary:t,hasResolvedCurrentLibrary:n}};function A(){const{saveSettings:e,setSettings:r}=(0,a.useDispatch)(o),{settings:t,isResolvingSettings:n,hasResolvedSettings:s}=(0,a.useSelect)((e=>{const{isResolving:r,hasFinishedResolution:t,getSettings:n}=e(o);return{settings:n(),isResolvingSettings:r("getSettings"),hasResolvedSettings:t("getSettings")}}),[]);return{settings:t,isResolvingSettings:n,hasResolvedSettings:s,hasSettings:!(!s||!Object.keys(t)?.length),saveSettings:e,setSettings:r}}const M=e=>({type:"SET_LIBRARIES",payload:e}),j=({body:e,headers:r})=>async({registry:t,dispatch:n,select:s})=>{const i=await _({method:"POST",body:e,headers:r});if(i?.code||0===i?.code)return t.dispatch(f.store).createSuccessNotice((0,y.sprintf)("%1$s: %2$s",i.code,i.message),{type:"snackbar"}),!1;const a=s.getLibraries(),o=i,c=a.findIndex((e=>e.name===o.name));return a[c]={...a[c],json_file_url:o.json_file_url,stylesheet_file_url:o.stylesheet_file_url,is_loaded:!0},n.setLibraries([...a]),n.setCurrentLibraryName(o.name),t.dispatch(f.store).createSuccessNotice((0,y.__)("The library has been created successfully.","wp-menu-icons"),{type:"snackbar"}),!0},O=e=>async({registry:r,dispatch:t,select:n})=>{const s=await R(e);if(s?.code)return r.dispatch(f.store).createSuccessNotice((0,y.sprintf)("%1$s: %2$s",s.code,s.message),{type:"snackbar"}),!1;const i=n.getLibraries(),a=i.findIndex((r=>r.name===e));return i[a]={...i[a],stylesheet_file_url:!1,json_url:!1,is_loaded:!1},t.setLibraries([...i]),r.dispatch(f.store).createSuccessNotice((0,y.sprintf)((0,y.__)("%s succesfully deleted!","wp-menu-icons"),i[a].label),{type:"snackbar"}),t.setCurrentLibraryName(e),!0},k=e=>({type:"SET_CURRENT_LIBRARY_NAME",payload:e}),P=e=>({type:"SET_SETTINGS",payload:e}),$=e=>async({registry:r,dispatch:t})=>{const n=await v({method:"POST",data:e});return n?.code?(r.dispatch(f.store).createSuccessNotice((0,y.sprintf)("%1$s: %2$s",n.code,n.message),{type:"snackbar"}),!1):(t.setSettings({...e}),r.dispatch(f.store).createSuccessNotice((0,y.__)("Settings saved.","wp-menu-icons"),{type:"snackbar"}),!0)},B=async()=>{try{const e=await S();return M(Object.values(e))}catch(e){console.error(e)}},D=async()=>{try{const e=await v();return P(e)}catch(e){console.error(e)}},F=async e=>{try{const r=await w(e);return k(r)}catch(e){console.error(e)}};function x(e=c,r){switch(r.type){case"SET_LIBRARIES":return{...e,libraries:r.payload};case"SET_CURRENT_LIBRARY_NAME":return{...e,currentLibraryName:r.payload};case"SET_SETTINGS":return{...e,settings:r.payload}}return e}const U=(0,a.createReduxStore)(o,{reducer:x,actions:n,selectors:t,resolvers:s});(0,a.register)(U);const G=o;(window.wpmi=window.wpmi||{}).store=r}();